---
- hosts: localhost
  gather_facts: false
  connection: local
  vars:
    - jenkins_workspace: "{{ jenkins_workspace }}"
  tasks:
    - name: Updating apiserver_loadbalancer_domain_name on inventory/mycluster/group_vars/all/all.yml
      ansible.builtin.lineinfile:
        path: "{{ jenkins_workspace }}kubespray/inventory/mycluster/group_vars/all/all.yml"
        regexp: "^## apiserver_loadbalancer_domain_name: "
        line: "apiserver_loadbalancer_domain_name: {{ apiserver_loadbalancer_domain_name }}"
      when: use_external_load_balancer | bool == true

    - name: Updating loadbalancer_apiserver address on inventory/mycluster/group_vars/all/all.yml
      ansible.builtin.lineinfile:
        path: "{{ jenkins_workspace }}kubespray/inventory/mycluster/group_vars/all/all.yml"
        regexp: "^#   address: "
        line: "  address: {{ apiserver_loadbalancer_address }}"
      when: use_external_load_balancer | bool == true

    - name: Updating loadbalancer_apiserver port on inventory/mycluster/group_vars/all/all.yml
      ansible.builtin.lineinfile:
        path: "{{ jenkins_workspace }}kubespray/inventory/mycluster/group_vars/all/all.yml"
        regexp: "^#   port: "
        line: "  port: {{ apiserver_loadbalancer_port }}"
      when: use_external_load_balancer | bool == true
    
#     - name: Tar kubespray directory
#       shell: |
#         cd {{ jenkins_workspace }} ; tar -czvf kubespray_Jenkins_Copy.tar.gz {{ jenkins_workspace }}/kubespray/

# - hosts: kube_control_plane[0]
#   gather_facts: false
#   tasks:
#     - name: Cloning project on master node
#       shell: |
#         rm -rf /opt/kubespray_Jenkins_Copy.tar.gz

#     - name: Making a copy of the kubespray project on one of the control plane nodes
#       copy:
#         src: "{{ jenkins_workspace }}kubespray_Jenkins_Copy.tar.gz"
#         dest: /opt/
